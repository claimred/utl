#ifndef _GAME_MAP_H_
#define _GAME_MAP_H_

#include <vector>

namespace utl_core
{
   namespace mapelem
   {
      enum MapElem 
      {
         // Offsets
         OFS_0 = 0, OFS_1, OFS_2, OFS_3, OFS_4, OFS_5, OFS_6,
         OFS_7, OFS_8, OFS_9, OFS_10, OFS_11, OFS_12,
         OFS_13, OFS_14, OFS_15, OFS_16, OFS_17, OFS_18,
         OFS_19, OFS_20, OFS_21, OFS_22, OFS_23, OFS_24,
         OFS_25, OFS_26, OFS_27, OFS_28, OFS_29, OFS_30,
         OFS_31, OFS_32, OFS_33, OFS_34,

         //TODO: What? Character in game map class?
         //Down
         CHARACTER1, CHARACTER11, CHARACTER12, CHARACTER13, 
         //up
         CHARACTER2, CHARACTER21, CHARACTER22, CHARACTER23, 
         //right
         CHARACTER3, CHARACTER31, CHARACTER32, CHARACTER33, 
         //left
         CHARACTER4, CHARACTER41, CHARACTER42, CHARACTER43, 


         CHARACTERM10, CHARACTERM11, CHARACTERM12, CHARACTERM13, 

         CHARACTERM20, CHARACTERM21, CHARACTERM22, CHARACTERM23, 

         CHARACTERM30, CHARACTERM31, CHARACTERM32, CHARACTERM33, 

         CHARACTERM40, CHARACTERM41, CHARACTERM42, CHARACTERM43, 

         SAND,

         // Sand to water tiles
        S2W_0101, S2W_0102, S2W_0103, S2W_0104, S2W_0105, S2W_0106, S2W_0107, S2W_0108, S2W_0109, S2W_0110, S2W_0111, S2W_0112, S2W_0113, S2W_0114, S2W_0115, S2W_0116, 
        S2W_0201, S2W_0202, S2W_0203, S2W_0204, S2W_0205, S2W_0206, S2W_0207, S2W_0208, S2W_0209, S2W_0210, S2W_0211, S2W_0212, S2W_0213, S2W_0214, S2W_0215, S2W_0216, 
        S2W_0301, S2W_0302, S2W_0303, S2W_0304, S2W_0305, S2W_0306, S2W_0307, S2W_0308, S2W_0309, S2W_0310, S2W_0311, S2W_0312, S2W_0313, S2W_0314, S2W_0315, S2W_0316, 
        S2W_0401, S2W_0402, S2W_0403, S2W_0404, S2W_0405, S2W_0406, S2W_0407, S2W_0408, S2W_0409, S2W_0410, S2W_0411, S2W_0412, S2W_0413, S2W_0414, S2W_0415, S2W_0416, 
        S2W_0501, S2W_0502, S2W_0503, S2W_0504, S2W_0505, S2W_0506, S2W_0507, S2W_0508, S2W_0509, S2W_0510, S2W_0511, S2W_0512, S2W_0513, S2W_0514, S2W_0515, S2W_0516, 
        S2W_0601, S2W_0602, S2W_0603, S2W_0604, S2W_0605, S2W_0606, S2W_0607, S2W_0608, S2W_0609, S2W_0610, S2W_0611, S2W_0612, S2W_0613, S2W_0614, S2W_0615, S2W_0616, 
        S2W_0701, S2W_0702, S2W_0703, S2W_0704, S2W_0705, S2W_0706, S2W_0707, S2W_0708, S2W_0709, S2W_0710, S2W_0711, S2W_0712, S2W_0713, S2W_0714, S2W_0715, S2W_0716, 
        S2W_0801, S2W_0802, S2W_0803, S2W_0804, S2W_0805, S2W_0806, S2W_0807, S2W_0808, S2W_0809, S2W_0810, S2W_0811, S2W_0812, S2W_0813, S2W_0814, S2W_0815, S2W_0816, 
        S2W_0901, S2W_0902, S2W_0903, S2W_0904, S2W_0905, S2W_0906, S2W_0907, S2W_0908, S2W_0909, S2W_0910, S2W_0911, S2W_0912, S2W_0913, S2W_0914, S2W_0915, S2W_0916, 
        S2W_1001, S2W_1002, S2W_1003, S2W_1004, S2W_1005, S2W_1006, S2W_1007, S2W_1008, S2W_1009, S2W_1010, S2W_1011, S2W_1012, S2W_1013, S2W_1014, S2W_1015, S2W_1016, 
        S2W_1101, S2W_1102, S2W_1103, S2W_1104, S2W_1105, S2W_1106, S2W_1107, S2W_1108, S2W_1109, S2W_1110, S2W_1111, S2W_1112, S2W_1113, S2W_1114, S2W_1115, S2W_1116, 
        S2W_1201, S2W_1202, S2W_1203, S2W_1204, S2W_1205, S2W_1206, S2W_1207, S2W_1208, S2W_1209, S2W_1210, S2W_1211, S2W_1212, S2W_1213, S2W_1214, S2W_1215, S2W_1216, 
        S2W_1301, S2W_1302, S2W_1303, S2W_1304, S2W_1305, S2W_1306, S2W_1307, S2W_1308, S2W_1309, S2W_1310, S2W_1311, S2W_1312, S2W_1313, S2W_1314, S2W_1315, S2W_1316, 
        S2W_1401, S2W_1402, S2W_1403, S2W_1404, S2W_1405, S2W_1406, S2W_1407, S2W_1408, S2W_1409, S2W_1410, S2W_1411, S2W_1412, S2W_1413, S2W_1414, S2W_1415, S2W_1416, 
        S2W_1501, S2W_1502, S2W_1503, S2W_1504, S2W_1505, S2W_1506, S2W_1507, S2W_1508, S2W_1509, S2W_1510, S2W_1511, S2W_1512, S2W_1513, S2W_1514, S2W_1515, S2W_1516, 
        S2W_1601, S2W_1602, S2W_1603, S2W_1604, S2W_1605, S2W_1606, S2W_1607, S2W_1608, S2W_1609, S2W_1610, S2W_1611, S2W_1612, S2W_1613, S2W_1614, S2W_1615, S2W_1616, 
        S2W_1701, S2W_1702, S2W_1703, S2W_1704, S2W_1705, S2W_1706, S2W_1707, S2W_1708, S2W_1709, S2W_1710, S2W_1711, S2W_1712, S2W_1713, S2W_1714, S2W_1715, S2W_1716, 
        S2W_1801, S2W_1802, S2W_1803, S2W_1804, S2W_1805, S2W_1806, S2W_1807, S2W_1808, S2W_1809, S2W_1810, S2W_1811, S2W_1812, S2W_1813, S2W_1814, S2W_1815, S2W_1816, 
        S2W_1901, S2W_1902, S2W_1903, S2W_1904, S2W_1905, S2W_1906, S2W_1907, S2W_1908, S2W_1909, S2W_1910, S2W_1911, S2W_1912, S2W_1913, S2W_1914, S2W_1915, S2W_1916, 
        S2W_2001, S2W_2002, S2W_2003, S2W_2004, S2W_2005, S2W_2006, S2W_2007, S2W_2008, S2W_2009, S2W_2010, S2W_2011, S2W_2012, S2W_2013, S2W_2014, S2W_2015, S2W_2016, 
        S2W_2101, S2W_2102, S2W_2103, S2W_2104, S2W_2105, S2W_2106, S2W_2107, S2W_2108, S2W_2109, S2W_2110, S2W_2111, S2W_2112, S2W_2113, S2W_2114, S2W_2115, S2W_2116, 
        S2W_2201, S2W_2202, S2W_2203, S2W_2204, S2W_2205, S2W_2206, S2W_2207, S2W_2208, S2W_2209, S2W_2210, S2W_2211, S2W_2212, S2W_2213, S2W_2214, S2W_2215, S2W_2216, 
        S2W_2301, S2W_2302, S2W_2303, S2W_2304, S2W_2305, S2W_2306, S2W_2307, S2W_2308, S2W_2309, S2W_2310, S2W_2311, S2W_2312, S2W_2313, S2W_2314, S2W_2315, S2W_2316, 
        S2W_2401, S2W_2402, S2W_2403, S2W_2404, S2W_2405, S2W_2406, S2W_2407, S2W_2408, S2W_2409, S2W_2410, S2W_2411, S2W_2412, S2W_2413, S2W_2414, S2W_2415, S2W_2416, 
        S2W_2501, S2W_2502, S2W_2503, S2W_2504, S2W_2505, S2W_2506, S2W_2507, S2W_2508, S2W_2509, S2W_2510, S2W_2511, S2W_2512, S2W_2513, S2W_2514, S2W_2515, S2W_2516, 
        S2W_2601, S2W_2602, S2W_2603, S2W_2604, S2W_2605, S2W_2606, S2W_2607, S2W_2608, S2W_2609, S2W_2610, S2W_2611, S2W_2612, S2W_2613, S2W_2614, S2W_2615, S2W_2616, 
        S2W_2701, S2W_2702, S2W_2703, S2W_2704, S2W_2705, S2W_2706, S2W_2707, S2W_2708, S2W_2709, S2W_2710, S2W_2711, S2W_2712, S2W_2713, S2W_2714, S2W_2715, S2W_2716, 
        S2W_2801, S2W_2802, S2W_2803, S2W_2804, S2W_2805, S2W_2806, S2W_2807, S2W_2808, S2W_2809, S2W_2810, S2W_2811, S2W_2812, S2W_2813, S2W_2814, S2W_2815, S2W_2816, 
        S2W_2901, S2W_2902, S2W_2903, S2W_2904, S2W_2905, S2W_2906, S2W_2907, S2W_2908, S2W_2909, S2W_2910, S2W_2911, S2W_2912, S2W_2913, S2W_2914, S2W_2915, S2W_2916, 
        S2W_3001, S2W_3002, S2W_3003, S2W_3004, S2W_3005, S2W_3006, S2W_3007, S2W_3008, S2W_3009, S2W_3010, S2W_3011, S2W_3012, S2W_3013, S2W_3014, S2W_3015, S2W_3016, 
        S2W_3101, S2W_3102, S2W_3103, S2W_3104, S2W_3105, S2W_3106, S2W_3107, S2W_3108, S2W_3109, S2W_3110, S2W_3111, S2W_3112, S2W_3113, S2W_3114, S2W_3115, S2W_3116, 
        S2W_3201, S2W_3202, S2W_3203, S2W_3204, S2W_3205, S2W_3206, S2W_3207, S2W_3208, S2W_3209, S2W_3210, S2W_3211, S2W_3212, S2W_3213, S2W_3214, S2W_3215, S2W_3216, 
        S2W_3301, S2W_3302, S2W_3303, S2W_3304, S2W_3305, S2W_3306, S2W_3307, S2W_3308, S2W_3309, S2W_3310, S2W_3311, S2W_3312, S2W_3313, S2W_3314, S2W_3315, S2W_3316, 
        S2W_3401, S2W_3402, S2W_3403, S2W_3404, S2W_3405, S2W_3406, S2W_3407, S2W_3408, S2W_3409, S2W_3410, S2W_3411, S2W_3412, S2W_3413, S2W_3414, S2W_3415, S2W_3416, 

         GRASS,

         // Grass to sand tiles
         G2S_1, G2S_2, G2S_3, G2S_4, G2S_5, G2S_6,
         G2S_7, G2S_8, G2S_9, G2S_10, G2S_11, G2S_12,
         G2S_13, G2S_14, G2S_15, G2S_16, G2S_17, G2S_18,
         G2S_19, G2S_20, G2S_21, G2S_22, G2S_23, G2S_24, 
         G2S_25, G2S_26, G2S_27, G2S_28, G2S_29, G2S_30, 
         G2S_31, G2S_32, G2S_33, G2S_34,


         TREE,
         WATER,
         WATER1,
         WATER2,
         WATER3,
         WATER4,
         WATER5,
         WATER6,
         WATER7,
         WATER8,
         WATER9,
         WATER10,
         WATER11,
         WATER12,
         WATER13,
         WATER14,
         WATER15,

         // Water to grass tiles
         W2G_0101, W2G_0102, W2G_0103, W2G_0104, W2G_0105, W2G_0106, W2G_0107, W2G_0108, W2G_0109, W2G_0110, W2G_0111, W2G_0112, W2G_0113, W2G_0114, W2G_0115, W2G_0116, 
         W2G_0201, W2G_0202, W2G_0203, W2G_0204, W2G_0205, W2G_0206, W2G_0207, W2G_0208, W2G_0209, W2G_0210, W2G_0211, W2G_0212, W2G_0213, W2G_0214, W2G_0215, W2G_0216, 
         W2G_0301, W2G_0302, W2G_0303, W2G_0304, W2G_0305, W2G_0306, W2G_0307, W2G_0308, W2G_0309, W2G_0310, W2G_0311, W2G_0312, W2G_0313, W2G_0314, W2G_0315, W2G_0316, 
         W2G_0401, W2G_0402, W2G_0403, W2G_0404, W2G_0405, W2G_0406, W2G_0407, W2G_0408, W2G_0409, W2G_0410, W2G_0411, W2G_0412, W2G_0413, W2G_0414, W2G_0415, W2G_0416, 
         W2G_0501, W2G_0502, W2G_0503, W2G_0504, W2G_0505, W2G_0506, W2G_0507, W2G_0508, W2G_0509, W2G_0510, W2G_0511, W2G_0512, W2G_0513, W2G_0514, W2G_0515, W2G_0516, 
         W2G_0601, W2G_0602, W2G_0603, W2G_0604, W2G_0605, W2G_0606, W2G_0607, W2G_0608, W2G_0609, W2G_0610, W2G_0611, W2G_0612, W2G_0613, W2G_0614, W2G_0615, W2G_0616, 
         W2G_0701, W2G_0702, W2G_0703, W2G_0704, W2G_0705, W2G_0706, W2G_0707, W2G_0708, W2G_0709, W2G_0710, W2G_0711, W2G_0712, W2G_0713, W2G_0714, W2G_0715, W2G_0716, 
         W2G_0801, W2G_0802, W2G_0803, W2G_0804, W2G_0805, W2G_0806, W2G_0807, W2G_0808, W2G_0809, W2G_0810, W2G_0811, W2G_0812, W2G_0813, W2G_0814, W2G_0815, W2G_0816, 
         W2G_0901, W2G_0902, W2G_0903, W2G_0904, W2G_0905, W2G_0906, W2G_0907, W2G_0908, W2G_0909, W2G_0910, W2G_0911, W2G_0912, W2G_0913, W2G_0914, W2G_0915, W2G_0916, 
         W2G_1001, W2G_1002, W2G_1003, W2G_1004, W2G_1005, W2G_1006, W2G_1007, W2G_1008, W2G_1009, W2G_1010, W2G_1011, W2G_1012, W2G_1013, W2G_1014, W2G_1015, W2G_1016, 
         W2G_1101, W2G_1102, W2G_1103, W2G_1104, W2G_1105, W2G_1106, W2G_1107, W2G_1108, W2G_1109, W2G_1110, W2G_1111, W2G_1112, W2G_1113, W2G_1114, W2G_1115, W2G_1116, 
         W2G_1201, W2G_1202, W2G_1203, W2G_1204, W2G_1205, W2G_1206, W2G_1207, W2G_1208, W2G_1209, W2G_1210, W2G_1211, W2G_1212, W2G_1213, W2G_1214, W2G_1215, W2G_1216, 
         W2G_1301, W2G_1302, W2G_1303, W2G_1304, W2G_1305, W2G_1306, W2G_1307, W2G_1308, W2G_1309, W2G_1310, W2G_1311, W2G_1312, W2G_1313, W2G_1314, W2G_1315, W2G_1316, 
         W2G_1401, W2G_1402, W2G_1403, W2G_1404, W2G_1405, W2G_1406, W2G_1407, W2G_1408, W2G_1409, W2G_1410, W2G_1411, W2G_1412, W2G_1413, W2G_1414, W2G_1415, W2G_1416, 
         W2G_1501, W2G_1502, W2G_1503, W2G_1504, W2G_1505, W2G_1506, W2G_1507, W2G_1508, W2G_1509, W2G_1510, W2G_1511, W2G_1512, W2G_1513, W2G_1514, W2G_1515, W2G_1516, 
         W2G_1601, W2G_1602, W2G_1603, W2G_1604, W2G_1605, W2G_1606, W2G_1607, W2G_1608, W2G_1609, W2G_1610, W2G_1611, W2G_1612, W2G_1613, W2G_1614, W2G_1615, W2G_1616, 
         W2G_1701, W2G_1702, W2G_1703, W2G_1704, W2G_1705, W2G_1706, W2G_1707, W2G_1708, W2G_1709, W2G_1710, W2G_1711, W2G_1712, W2G_1713, W2G_1714, W2G_1715, W2G_1716, 
         W2G_1801, W2G_1802, W2G_1803, W2G_1804, W2G_1805, W2G_1806, W2G_1807, W2G_1808, W2G_1809, W2G_1810, W2G_1811, W2G_1812, W2G_1813, W2G_1814, W2G_1815, W2G_1816, 
         W2G_1901, W2G_1902, W2G_1903, W2G_1904, W2G_1905, W2G_1906, W2G_1907, W2G_1908, W2G_1909, W2G_1910, W2G_1911, W2G_1912, W2G_1913, W2G_1914, W2G_1915, W2G_1916, 
         W2G_2001, W2G_2002, W2G_2003, W2G_2004, W2G_2005, W2G_2006, W2G_2007, W2G_2008, W2G_2009, W2G_2010, W2G_2011, W2G_2012, W2G_2013, W2G_2014, W2G_2015, W2G_2016, 
         W2G_2101, W2G_2102, W2G_2103, W2G_2104, W2G_2105, W2G_2106, W2G_2107, W2G_2108, W2G_2109, W2G_2110, W2G_2111, W2G_2112, W2G_2113, W2G_2114, W2G_2115, W2G_2116, 
         W2G_2201, W2G_2202, W2G_2203, W2G_2204, W2G_2205, W2G_2206, W2G_2207, W2G_2208, W2G_2209, W2G_2210, W2G_2211, W2G_2212, W2G_2213, W2G_2214, W2G_2215, W2G_2216, 
         W2G_2301, W2G_2302, W2G_2303, W2G_2304, W2G_2305, W2G_2306, W2G_2307, W2G_2308, W2G_2309, W2G_2310, W2G_2311, W2G_2312, W2G_2313, W2G_2314, W2G_2315, W2G_2316, 
         W2G_2401, W2G_2402, W2G_2403, W2G_2404, W2G_2405, W2G_2406, W2G_2407, W2G_2408, W2G_2409, W2G_2410, W2G_2411, W2G_2412, W2G_2413, W2G_2414, W2G_2415, W2G_2416, 
         W2G_2501, W2G_2502, W2G_2503, W2G_2504, W2G_2505, W2G_2506, W2G_2507, W2G_2508, W2G_2509, W2G_2510, W2G_2511, W2G_2512, W2G_2513, W2G_2514, W2G_2515, W2G_2516, 
         W2G_2601, W2G_2602, W2G_2603, W2G_2604, W2G_2605, W2G_2606, W2G_2607, W2G_2608, W2G_2609, W2G_2610, W2G_2611, W2G_2612, W2G_2613, W2G_2614, W2G_2615, W2G_2616, 
         W2G_2701, W2G_2702, W2G_2703, W2G_2704, W2G_2705, W2G_2706, W2G_2707, W2G_2708, W2G_2709, W2G_2710, W2G_2711, W2G_2712, W2G_2713, W2G_2714, W2G_2715, W2G_2716, 
         W2G_2801, W2G_2802, W2G_2803, W2G_2804, W2G_2805, W2G_2806, W2G_2807, W2G_2808, W2G_2809, W2G_2810, W2G_2811, W2G_2812, W2G_2813, W2G_2814, W2G_2815, W2G_2816, 
         W2G_2901, W2G_2902, W2G_2903, W2G_2904, W2G_2905, W2G_2906, W2G_2907, W2G_2908, W2G_2909, W2G_2910, W2G_2911, W2G_2912, W2G_2913, W2G_2914, W2G_2915, W2G_2916, 
         W2G_3001, W2G_3002, W2G_3003, W2G_3004, W2G_3005, W2G_3006, W2G_3007, W2G_3008, W2G_3009, W2G_3010, W2G_3011, W2G_3012, W2G_3013, W2G_3014, W2G_3015, W2G_3016, 
         W2G_3101, W2G_3102, W2G_3103, W2G_3104, W2G_3105, W2G_3106, W2G_3107, W2G_3108, W2G_3109, W2G_3110, W2G_3111, W2G_3112, W2G_3113, W2G_3114, W2G_3115, W2G_3116, 
         W2G_3201, W2G_3202, W2G_3203, W2G_3204, W2G_3205, W2G_3206, W2G_3207, W2G_3208, W2G_3209, W2G_3210, W2G_3211, W2G_3212, W2G_3213, W2G_3214, W2G_3215, W2G_3216, 
         W2G_3301, W2G_3302, W2G_3303, W2G_3304, W2G_3305, W2G_3306, W2G_3307, W2G_3308, W2G_3309, W2G_3310, W2G_3311, W2G_3312, W2G_3313, W2G_3314, W2G_3315, W2G_3316, 
         W2G_3401, W2G_3402, W2G_3403, W2G_3404, W2G_3405, W2G_3406, W2G_3407, W2G_3408, W2G_3409, W2G_3410, W2G_3411, W2G_3412, W2G_3413, W2G_3414, W2G_3415, W2G_3416, 

         GRAVE,

         // Gravel to grass tiles
         GR2G_1, GR2G_2, GR2G_3, GR2G_4, GR2G_5, GR2G_6,
         GR2G_7, GR2G_8, GR2G_9, GR2G_10, GR2G_11, GR2G_12,
         GR2G_13, GR2G_14, GR2G_15, GR2G_16, GR2G_17, GR2G_18,
         GR2G_19, GR2G_20, GR2G_21, GR2G_22, GR2G_23, GR2G_24, 
         GR2G_25, GR2G_26, GR2G_27, GR2G_28, GR2G_29, GR2G_30, 
         GR2G_31, GR2G_32, GR2G_33, GR2G_34,

         TREE2,
         TREE3,
         TREE4,
         TREE5,

         FLOWERS1,
         FLOWERS2,
         FLOWERS3,

         BRANCHES,
         MUD,
         STONE1,
         STONE2,
         STONE3,
         STONE4,
         STONE5,
         STONE6,
         STONE7,

         BUSH1,
         BUSH2,
         BUSH3,
         BUSH4,
         BUSH5,
         BUSH6,

         LIGHTFIELD1,
         LIGHTFIELD2,

         ALPHA1,
         ALPHA2,
         ALPHA3,
         ALPHA4,

         TREE1_SEL,
         TREE2_SEL,
         TREE3_SEL,
         TREE4_SEL,
         TREE5_SEL,

         STOMP1, STOMP2, STOMP3, STOMP4, STOMP5
      };
   }

   struct MapObject
   {
      int x, y, xoffset, yoffset;
      mapelem::MapElem el, el_sel;

      MapObject() : el_sel(mapelem::OFS_0)
      {

      };

      static bool compareMapObjects( const MapObject *a, const MapObject *b )
      {
         int x1 = a->x, x2 = b->x, y1 = a->y, y2 = b->y;

         if (y1 < y2)
            return true;

         if (y1 > y2)
            return false;

         if (y1 == y2)
         {
            if (x1 < x2)
               return true;

            if (x1 >= x2)
               return false;
         }

         return false;
      }
   };

   class GameMap
   {
   public:

      GameMap();

      void fill( mapelem::MapElem el );
      void clear();

      void setElem( int i, int j, mapelem::MapElem el );
      mapelem::MapElem getElem( int i, int j );
      
      int getWalkableW();
      int getWalkableH();

      void initWalkable();
      bool isMicroWalkable( int p, int q );
      bool isMacroWalkable( int i, int j );
      void setWalkable( int p, int q, bool val );

      void getSize( std::pair<int, int> &sizes );
      bool isInit();

      //TODO: Dangerous function, can be called only from gms. Friend class?
      bool create( int sizex, int sizey );

      std::vector<MapObject *> *getObjects();
      MapObject *addObject( const MapObject &mo );
      void updateObjects();

      ~GameMap();

   private:
      
      int _sizeX, _sizeY, _allocCount;
      int _width, _height;
      bool _isInit;
      const int _bulkSize;

      mapelem::MapElem *_map;
      std::vector<MapObject *> _objects;
      MapObject *_bulk;
      bool **_walkable;

      GameMap( const GameMap &gm );
   };

}

#endif /* _GAME_MAP_H_ */